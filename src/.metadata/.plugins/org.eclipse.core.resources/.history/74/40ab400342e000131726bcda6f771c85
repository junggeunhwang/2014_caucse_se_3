package model;

import java.util.Vector;
import java.io.*;
import java.util.Stack;
import java.util.ArrayList;

public class ClusterModel extends DsmModel {
	
	public void readCluster(String filePath, int pivot)
	{
		String cluster[][] = new String [2][pivot];
		try
		 {
			File file = new File("after_partitioning_simple.clsx");
			FileInputStream fis = new FileInputStream(file);
			InputStreamReader isr = new InputStreamReader(fis, "UTF-8"); 
			BufferedReader br = new BufferedReader(isr);
			
			String temp="";
			int groupNum=0;
			Stack<String> s = new Stack<String>();
			TreeNode newRoot = new TreeNode();
			while(((temp = br.readLine()) != null)) 
			{
				String[] str= temp.split("\"",3);
				if(str[0].compareTo("<group name=")==0)
				{
					TreeNode newNode = new TreeNode();
					newNode.setKey(str[1]);
					if(groupNum == 0)
					{
						newNode.parent=null;
						newRoot = newNode;
					}
					else
						newRoot.getNode(s.peek()).setChild(newNode);
					s.push(str[1]);
					groupNum++;
				}
				else if(str[0].compareTo("<item name=")==0)
				{
					TreeNode newNode = new TreeNode();
					newNode.setKey(str[1]);
					newRoot.getNode(s.peek()).setChild(newNode);
				}
				else if(str[0].compareTo("</group>")==0)
				{
					groupNum--;
					if(groupNum==0)	break;
					s.pop();
				}
			}
			Vector<TreeNode> tempModules = new Vector<TreeNode>();
			Vector<TreeNode> tempModules2 = new Vector<TreeNode>();
			tempModules = newRoot.getLeafNode(tempModules2);
			updateDepend(tempModules);
			this.setModules(tempModules);
			this.setRoot(newRoot);
		 }
		 catch(FileNotFoundException fnfe){
			 System.out.println("파일을 찾을 수 없습니다.");
			 }catch(IOException ioe){}
	}

	public Vector<String> makeStr(Vector<String> printList, TreeNode T)
	{
		String addStr="";
		String groupOpen = "<group name=\"";
		String groupClose = "</group>";
		String itemOpen = "<item name=\"";
		if(T.childs.size()==0)
		{
			printList.add(itemOpen+T.key+"\" />");
		}
		else
		{
			printList.add(groupOpen+T.key+"\">");
			for(int i=0; i<T.childs.size(); i++)
				makeStr(printList,T.childs.get(i));
			printList.add(groupClose);
		}
		return printList;
		
	}
	
	public void writeCluster(String filePath, String fileName)
	{
		try{
			File file = new File(filePath, fileName);
			file.createNewFile();
			OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(file), "UTF-8");
			BufferedWriter buff_writer = new BufferedWriter(osw);
			PrintWriter print_writer = new PrintWriter(buff_writer,true);
			String clusterOpen = "<cluster>";
			String clusterClose = "</cluster>";
			String printStr = "";
			print_writer.println(new String(clusterOpen.getBytes("UTF-8"),"UTF-8"));
			Vector<String> printList = new Vector<String>();
			printList = makeStr(printList,root);
			for(int i=0; i<printList.size(); i++)
				print_writer.println(new String(printList.get(i).getBytes("UTF-8"),"UTF-8"));
			print_writer.println(new String(clusterClose.getBytes("UTF-8"),"UTF-8"));
			osw.close();
			buff_writer.close();
			print_writer.close();
		}catch(Exception e)
		{
			e.printStackTrace();
		}
	}

}
